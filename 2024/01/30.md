# 取り組んだ課題一覧
- 達人に学ぶDB設計

# わかったこと
- DBに格納されるファイル５種類: データファイル,インデックスファイル,システムファイル,一時ファイル,ログファイル
- 開発者:データファイル。インデックスファイル
- DBA(DatabaseAdministrator):システムファイル,一時ファイル,ログファイル
- データファイル:ユーザーがデータベースに格納するデータを保持するためのファイル,業務アプリケーションがSQLを通じて参照、更新を行うファイル,アプリケーションからはテーブルという論理的単位
- インデックスファイル:テーブルに作成されたインデックスファイルが格納される,DBMSではテーブルとインデックスファイルは分ける,インデックスを使うかどうかは、DBMS内部で勝手に判断する
- システムファイル:DBMSの内部管理用に使われるデータを格納
- 一時ファイル:DBMS内部で一時的なデータを格納する ex)SQLのサブクエリ,group by,distinctなどのデータ  処理が終了したら削除される
- ログファイル:DBMSはテーブルのデータ変更を受け付けた場合、即座に変更しているわけではなくログファイルに変更分を溜めて一括でデータファイルに変更を反映している,データファイルに変更が終われば不要のため削除される
- I/O量:データファイル>インデックスファイル>一時ファイル>ログファイル>システムファイル
- 画像データなどのバイナリファイルをDBに格納するケースも増えている,バイナリファイルの格納先も他のファイル群(データファイルなど)と分離するべき
- データ損失を防ぐためには、極力データを失わない設計にするorデータが失われた時に復旧できるようにする
- バックアップの基本はファイルコピー  ３つの方式を組み合わせていく、どれか一つだけというのは普通ない
- バックアップの種類は大きく３通り:フルバックアップ(完全バックアップ),差分バックアップ,増分バックアップ
- フルバックアップ:ある時点でそのシステムが保持している全てのデータをバックアップする方式. メリット:データの破損がなければ前日のバックアップを復元するだけで済む  デメリット:バックアップ時間が長い,ハードウェアリソースへの負荷が高い,サービス停止が必要
- 差分バックアップ:その日の変更分をバックアップして積み上げていくイメージ,ログファイルをバックアップする,ユーザから受け付けた変更をすぐにデータファイルに変更を反映するのではなくトランザクションログに溜め込むので、データベース内のデータに対する変更履歴が残っているのでこれをバックアップする,変更履歴だけあっても、大元のファイルがないと意味がないので、フルバックアップのデータも必要になる
- 差分バックアップメリット:バックアップのデータ量が減る,差分バックアップをフルバックアップと併用すれば、変更分のログファイルで済む,バックアップ時間の短縮と媒体の容量を小さくして節約することが出来る
- 差分バックアップデメリット:リカバリの時にフルバックアップも必要,リカバリの手順が増えて時間も長くなる,どちらかが破損していたら復旧できない
- 増分バックアップ:その日の変更分をバックアップしていくイメージ  増分バックアップのメリット:バックアップに要する時間が最小,コストも一番抑えられる  増分バックアップのデメリット:リカバリの手順が一番複雑になる,リカバリの時間も長くなる, 完全にデータを復旧できる可能性が最も低くなる
- バックアップ方式の採用基準4つ:1.いつ時点の状態に復旧させる必要があるか、そもそも復旧が必要か 2.バックアップに使用できる時間(バックパックウィンドウ) 3.リカバリに使用できる時間(リカバリウィンドウ) 4.何世代までのデータを残す必要があるか
- 上記の選択肢ごとの採用方式:1.バックアップしない 2.フルバックアップのみ 3.フルバックアップ+差分バックアップ 4.フルバックアップ+増分バックアップ
- 一般的なのは、3.フルバックアップ+差分バックアップ 4.フルバックアップ+増分バックアップの二つ  リカバリウィンドウが長くなる傾向があるので留意する
- リカバリ設計:バックアップ設計とリカバリ設計はセットで実施される,バックアップ方式が決まれば、リカバリ設計も決まる
- リストア:バックアップファイルを戻す作業  リカバリ:そのファイルに対してトランザクションログを適用して変更分を反映する作業
- DBMSの内部にもトランザクションログが残っている.その中に最後のバックアップ後に実施されたユーザからの変更分が含まれている.未バックアップのトランザクションログを適用することで、初めてデータは障害直前の状態に復旧する
- フルバックアップのファイルをデータベースに戻す→リストア,差分（または増分）バックアップしていたトランザクションログを適用する→リカバリ,DBサーバに残っているトランザクションログを適用する→ロールフォワード
- 1.上記の問題では、性能問題が発生していることをまず認識する。:性能問題=ハードウェアリソースの不足が原因
- 2.アクセスログの確認:ピーク時間帯のレスポンスタイムとスループットを調べて性能要件と比較する
- 3.ハードウェアリソースのログを確認する:調査事項→1.CPU使用率 2.メモリ 3.ディスク 4.ネットワーク  ピーク時間帯にリソースがキャパ限界まで来ている場合は、そこがボトルネックとなる.例えば、ピーク時間にCPUが９０％程度で高止まりしている場合はCPUを補強する。
- 4.新旧サーバの性能比較をする:50%程度まで抑えたいとなれば、ざっくり計算で90/50 = 1.8  最低1.8倍のCPUが必要となる。安全マージン取って2倍がベストかな？という感じ
- CPU評価はベンチマークを使用する。SPECint_rateがよく使用される。例えば50の結果だった場合は2倍の100を用意しなければならない。

# 次やること
- 達人に学ぶDB設計

# 感じたこと
- とりあえず2章まで終了

# 学習時間
- 3.25時間

# 累計学習時間
- 415.25時間
